name: Send a telegram
run-name: ${{ github.actor }} sending a telegram
on:
  push:
    branches: [ "main" ]
jobs:
  push:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        repository: jvont/telegram-boy
        ref: 'main'
        token: ${{ secrets.TELEGRAPH_TOKEN }}
        path: '.'
        fetch-depth: 0

    - name: make
      run: make telegraph

    - name: configure git
      run: |
        git config -l | grep 'http\..*\.extraheader' | cut -d= -f1 | \xargs -L1 git config --unset-all
        git config user.name ${{ github.actor }}
        git config user.email ${{ github.actor_id }}@users.noreply.github.com

    - name: push build artifacts
      run: |
        git add -f *.o telegraph
        git commit -m "test commit"
        git push -f -u origin main
